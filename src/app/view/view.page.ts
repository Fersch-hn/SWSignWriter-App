import { Component, OnInit, OnChanges } from '@angular/core';
import { DocumentService, Document } from '../document.service';
import { Router, NavigationStart, NavigationEnd } from '@angular/router';
import { SocialSharingService } from '../social-sharing.service';
import * as htmlToImage from 'html-to-image';


@Component({
  selector: 'app-view',
  templateUrl: './view.page.html',
  styleUrls: ['./view.page.scss']
})
export class ViewPage implements OnInit, OnChanges {
  constructor(
    private documentService: DocumentService,
    private socialSharingService: SocialSharingService,
    private router: Router
  ) {
    this.router.events.subscribe(event => {
      if (event instanceof NavigationStart) {
        console.log('ssw', ssw);
        const fsw =
        //  'M572x586S11502430x547S3780e410x577S3760a459x541S1010a442x570S1f511462x543S11a20485x533S14720506x541S17620527x547S11a20547x533S30104428x477S30804536x480S30a00428x488S30c00536x487S2f900551x527 S38800464x496 M537x582S14c59453x545S19a21515x518S32104482x482S25603494x545S2f900461x577 M530x590S14c59444x551S10d12503x512S32103482x482S35700482x482S2f900449x585S25603478x527S2f900479x554 M520x597S14c59457x529S15d21497x574S33f00482x487S32400482x487S26501483x560S30906482x478S2f900460x563S2fa00474x553 S38700463x496 M518x600S14c59446x552S19a51476x573S30906482x478S33f00482x487S26501469x571S32103482x487S2f900449x585 M542x588S14c59462x552S34800482x487S30906482x478S32103482x487S10121514x539S2aa03505x556S2f900467x583S25503496x539S2f900493x561 M521x600S14c59446x536S15d21498x577S26a01480x559S32400482x482S2fa00473x556S33f00482x482S2f900450x566 S38800464x496 M518x571S32400482x488S33f00482x488S30827495x482S14020472x541S14028435x541S30303482x477S28b2a467x529 M526x604S3760a504x552S3780e455x590S1010a487x582S30201482x477S33f00482x487S26500493x533S32400482x487S1f540497x545S2f900490x599 M526x605S3760a504x552S3780e455x590S1010a487x582S30201482x477S33f00482x487S10140494x538S32400482x487S26500493x533S2f900490x600 M526x613S3760a504x552S3780e455x590S30201482x477S15d00499x542S33f00482x487S32400482x487S1010a487x582S25f04501x573S2f900490x599 S38700463x496 M526x604S3760a504x552S3780e455x590S1010a487x582S10120494x538S32400482x487S2df06494x527S30200482x477S2f900490x599 M526x613S3760a504x552S3780e455x590S30200482x477S15d00499x542S33f00482x487S32400482x487S1010a487x582S25f04501x573S2f900490x599 S38700463x496 M526x606S25e04504x572S3780e455x591S30200482x478S32400482x488S33f00482x488S3760a504x553S19a50490x549S1010a487x583S30350482x476S2f900490x601 M526x605S1010a487x582S3780e455x590S30200482x477S32400482x487S33f00482x487S3760a504x552S15d20492x541S26a00491x528S2f900491x600 S38800464x496 M518x566S32400482x487S33f00482x487S30802482x478S14020474x536S14028438x536S28b2a466x526 M530x582S10109512x535S3770b492x560S20500505x545S1d010506x479S36d01479x528S32401480x487S26601490x463S30801480x478S2f900517x565 M525x558S10109470x510S3770b451x536S36d01475x524S15603456x478S37703469x491S32401489x487S22115468x487S33c00489x487S30801489x478S3715b516x521S25d05444x494S2f900475x539 M522x557S10109477x509S3770b458x535S36d01478x522S25f04463x494S37703475x491S32401486x487S19a20460x472S33e00486x487S30801486x478S2f900482x538 M534x562S1010a478x536S3770c456x547S36d01474x526S33e00498x487S37703487x517S32401498x487S15d20475x491S26a00474x470S30800498x478S3715b466x535S3715b516x523S2f900480x557 S38700463x496 M523x604S1010a487x581S3770e463x589S19c10495x516S32400482x486S33f00482x486S20500505x499S30908482x478S2f900489x599 M523x604S1010a487x581S3770e462x589S19c10495x516S32400482x486S33f00482x486S26c02500x547S30908482x478S2f900489x599 M548x589S32105492x487S14c5a508x558S18710530x512S26504532x496S20500504x516S36d03471x530S37706483x569S34700492x487S30806492x478S2f900515x584 M555x595S32105490x487S14c59491x564S34700490x487S36d03473x526S37807461x586S15210535x529S37701548x560S2c221509x519S30809490x478 S38700463x496 M558x605S32105486x486S14c59487x563S33f00486x486S36d03478x531S37707467x586S19a51535x529S25f04541x558S2f700543x598S3080b486x479S2f900495x590 M567x592S37700541x554S32400486x482S33f00486x482S36d03478x527S37707489x578S1011a511x570S15a20536x527S25f04551x534S2f900513x587 M599x592S37700541x554S32400486x482S33f00486x482S36d03478x527S37707488x578S1011a511x570S15a50536x527S22a00558x530S22a04572x531S22a00586x529S2f900514x587 S38800464x496';
         this.documentService.getFSW();

        this.document = ssw.paragraph(fsw);
      }

      if (event instanceof NavigationEnd) {
        // Hide loading indicator
      }
    });
  }
  public document: string;

  ngOnInit() {}
  ngOnChanges(changes: import('@angular/core').SimpleChanges): void {}

  public share() {
    const fsw = this.documentService.getFSW();
    this.document = ssw.paragraph(fsw, "png");

    requestAnimationFrame( () => this.sharecontinuation(fsw));
  }

  private async sharecontinuation(fsw: string){
    const node: any = document.getElementsByClassName('signtext')[0];
    
    const image1 = await htmlToImage.toPng(node)
   
      const img  = new Image();
      img.src = image1;
      this.document = ssw.paragraph(fsw);
    this.socialSharingService.share(img);
  }


}
